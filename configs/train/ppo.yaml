algorithm: ppo

data:
  train_path: data/repliqa/clean/train.jsonl
  eval_path: data/repliqa/clean/eval.jsonl
  documents_path: data/repliqa/clean/documents.jsonl

prompt:
  template: |
    You are a question answering assistant.

    Answer the question ONLY using the provided document.

    If the answer cannot be found in the document, say:
    FINAL: Not found

    Keep the answer concise. Do not provide explanation.

    Format your response exactly as:

    FINAL: <short answer>

    Document:
    {context}

    Question:
    {question}

training:
  mode: online_rl
  output_dir: runs/ppo_baseline
  per_device_train_batch_size: 1
  per_device_eval_batch_size: 1
  gradient_accumulation_steps: 1
  num_train_epochs: 1
  learning_rate: 5e-6
  max_prompt_length: 512
  max_completion_length: 64
  num_mini_batches: 1
  num_ppo_epochs: 4
  temperature: 1.0
  kl_coef: 0.05
  ppo_clip_range: 0.2
  reference_model: Qwen/Qwen2.5-3B-Instruct
  require_behavior_logprob: true  # legacy logged_replay only
  log_interval: 20
  gamma: 1.0
  lam: 0.95
  local_rollout_forward_batch_size: 1
  stop_token: eos
  require_stop_token_support: true
  missing_eos_penalty: 1.0
  add_special_tokens: true
  report_to: none
  # Optional adaptive KL (passed through when supported by installed TRL).
  # target_kl: 6.0
  # adap_kl_ctrl: true

reward_model:
  base_model_name: Qwen/Qwen2.5-0.5B-Instruct
  adapter_path: runs/reward_qwen05b_clean
  adapter_trainable: false
  freeze: true
  use_lora: false

reward_postprocess:
  enabled: true
  temperature: 1.0
  normalize: running_zscore
  running_momentum: 0.95
  min_count_for_running: 64
  update_stats_in_eval: false
  apply_tanh: true
  clip_min: null
  clip_max: null
  length_penalty: 0.0
  length_penalty_mode: response_tokens
  length_penalty_scale: sqrt
  eps: 1.0e-6

value_model:
  base_model_name: Qwen/Qwen2.5-0.5B-Instruct
  adapter_path: runs/reward_qwen05b_clean
  adapter_trainable: true
  freeze_backbone: false
  use_lora: false

lora:
  r: 16
  alpha: 32
  dropout: 0.05
  target_modules:
    - q_proj
    - v_proj
